# LitRelevanceAI 项目功能与架构概览

本文档基于 `AGENTS.md` 与核心源码整理，帮助开发者快速了解 LitRelevanceAI 的能力与实现结构。

## 核心功能

- **CSV 文献相关度分析**：`litrx csv` 命令读取 Scopus 导出的 CSV，对每篇文献计算 0–100 的相关度分数，并生成适合文献综述的撰写建议。GUI 中提供结果表格、详情弹窗与导出功能，处理过程会自动保存中间文件以防数据丢失。  
- **可配置的标题/摘要筛选**：`litrx abstract` 支持命令行和 GUI 模式。筛选问题源于 `questions_config.json` 中的模式定义，可对每个问题执行二次验证，将支持状态写入 `<列名>_verified` 字段，同时在 GUI 日志中用 ✔/✖ 标记。  
- **PDF 全文筛查**：`litrx pdf` 将 PDF 转成文本后，依据研究问题、筛选标准和细化问题生成分析结果。GUI Tab 支持批量文件、元数据匹配、仅元数据预检和结果目录打开。  
- **模块化图形界面**：`python run_gui.py` 或 `python -m litrx --gui` 会启动含 CSV、Abstract、PDF 三个标签页的 Tkinter 应用，顶部工具栏可切换 OpenAI/Gemini 服务并记忆各自的 API Key。  
- **统一的配置体系**：所有命令都会合并 `.env`、YAML/JSON 配置和命令行参数，得到 `DEFAULT_CONFIG`。GUI 的 **Save Config** 会写入 `~/.litrx_gui.yaml`，再次启动时自动恢复模型与密钥。  
- **自动依赖检测与保存**：`run_gui.py` 会在启动 GUI 前确保依赖齐全；CSV、摘要和 PDF 模块在分析过程中会定时写入中间或最终结果文件，防止中断造成损失。

## 代码架构

### 顶层入口与命令行调度
- `litrx/__main__.py` 既支持 `python -m litrx`，又能通过 `--gui` 直接启动图形界面；否则将剩余参数传递给 CLI 子命令解析器。  
- `litrx/cli.py` 定义 `csv`、`abstract`、`pdf` 三个子命令，其中 `abstract` 子命令支持 `--gui` 选项以便在同一入口下切换 GUI/CLI 模式。

### 核心功能模块
- **CSV 分析 (`litrx/csv_analyzer.py`)**：封装 `LiteratureAnalyzer`，负责读取 Scopus CSV、调用 `AIClient` 生成相关度评分与建议、实时保存分析结果，并提供交互式 CLI 配置。默认模型温度设置为 0.3。  
- **摘要筛选 (`litrx/abstract_screener.py`)**：扩展 `DEFAULT_CONFIG` 后加载 `questions_config.json` 中的模式问题，自动匹配标题/摘要列，按问题生成列与 `_verified` 字段，并可根据配置执行 AI 二次验证。  
- **PDF 筛查 (`litrx/pdf_screener.py`)**：在读取配置后加载 `configs/questions/pdf.yaml`，利用 `PdfReader` 提取文本，构造 prompt 提交给 `AIClient`，并支持元数据文件的标识匹配、进度条显示与结果导出格式选择。

### AI 客户端与配置管理
- `litrx/config.py` 统一处理 `.env` 变量与 JSON/YAML 配置合并，提供基础 `DEFAULT_CONFIG`。  
- `litrx/ai_client.py` 在 LiteLLM 之上封装 API 请求流程，根据服务类型写入环境变量并处理 Base URL，暴露 `request` 方法供各模块复用。

### GUI 结构
- `litrx/gui/base_window.py` 构建通用窗口：加载默认/持久化配置、提供服务切换、API Key 输入与保存功能，并维护 `ttk.Notebook` 用于挂载标签页。  
- `litrx/gui/main_window.py` 继承 `BaseWindow` 注册 `CsvTab`、`AbstractTab`、`PdfTab` 三个标签页，并提供 `launch_gui` 入口。  
- `run_gui.py` 在启动 GUI 前检测并安装所需依赖，然后调用 `launch_gui()`。

### 配置与资源文件
- `configs/config.yaml` 存放默认模型、服务和界面初始值；`configs/questions/*.yaml` 为各模块的提示模板。  
- `questions_config.json` 保存摘要筛选模式定义，GUI 会读取/写回该文件。

## 典型工作流概览
1. 用户通过 CLI 或 GUI 选择分析模式并加载配置。`config.py` 与 `.env` 合并生成最终配置。  
2. 模块根据配置初始化 `AIClient`，准备问题模板或列结构。  
3. 对输入数据（CSV/摘要/PDF）逐条调用模型获取结果，并根据需要执行二次验证或元数据匹配。  
4. 结果写回 DataFrame 或表格，并输出到 CSV/XLSX，GUI 同步展示状态。
